# 修改 train_cma.py 为单进程串行执行 (生成汇总报告)

根据您的详细要求，我将重构代码以生成包含完整元数据的汇总 JSON 文件。

## 1. 重构 `CMAESOptimizer` 类
-   **初始化 (`__init__`)**: 移入 CMA-ES 初始化逻辑。
-   **训练步 (`step`)**: 执行单代训练，更新内部的最佳 Fitness 和对应的详细 Metrics。
-   **数据提取 (`get_best_result`)**: 新增方法，返回标准化的结果字典：
    ```python
    {
        "best_fitness": ...,
        "avg_power": ...,
        "spec_occ": ...,
        "components": { "source": ..., "detector": ..., ... }
    }
    ```

## 2. 重写主执行逻辑 (`main` 函数)
-   **配置**: 设定 `Map=Paris`, `Traffic=Low` 等参数。
-   **初始化**: 创建两个优化器。
-   **主循环**:
    1.  交替执行 `step()`。
    2.  **生成汇总报告**: 每次循环都构建并覆盖写入 `comparison_result.json`，内容包含：
        -   **Metadata**: `map_name`, `traffic`, `protocol`, `detector`
        -   **Current Generation**: `gen`
        -   **Bypass Results**: 调用 `opt_bypass.get_best_result()`
        -   **NoBypass Results**: 调用 `opt_nobypass.get_best_result()`
    3.  **停止逻辑**:
        -   Warmup: 10代。
        -   Check: 每一代。
        -   Condition: `Bypass Power < NoBypass Power` **且** `Bypass Spec > NoBypass Spec`。

## 3. 文件输出
-   最终会产生一个 `comparison_result.json`，完整记录了实验配置和两者在“最好的Fitness”下的详细性能指标对比。
-   保持 `evaluate` 和其他核心算法逻辑不变。